# Feature Store 삭제 기능 구현 계획

## 개요
SageMaker Feature Store CLI에 feature group 완전 삭제 기능을 추가합니다. 이 기능은 기존 `clear` 명령어와 달리 feature group 자체를 완전히 삭제합니다.

> **주의**: 이는 기존 `clear` 명령어와는 다릅니다.
> - `clear`: 데이터만 삭제 (feature group은 유지)
> - `delete`: feature group 자체를 완전히 삭제

## 명령어 설계

### 기본 명령어 구조
```bash
fs delete [OPTIONS] FEATURE_GROUP_NAME
```

### 주요 옵션
- `--force / --no-force`: 확인 없이 강제 삭제 (기본값: False)
- `--delete-data / --keep-data`: 데이터 삭제 여부 (기본값: True)
- `--wait / --no-wait`: 삭제 완료까지 대기 여부 (기본값: True)
- `--dry-run`: 실제 삭제 없이 삭제 계획만 표시

### 사용 예시
```bash
# 기본 삭제 (확인 프롬프트 포함)
fs delete my-feature-group

# 강제 삭제 (확인 없이)
fs delete my-feature-group --force

# 데이터는 유지하고 feature group만 삭제
fs delete my-feature-group --keep-data

# 삭제 계획만 확인 (실제 삭제 안함)
fs delete my-feature-group --dry-run

# 삭제 후 대기하지 않음
fs delete my-feature-group --no-wait
```

## 삭제 프로세스

### 1. 삭제 전 검증
1. **Feature Group 존재 확인**: 대상 feature group 존재 여부
2. **상태 확인**: 삭제 가능한 상태인지 확인
3. **종속성 확인**: 
   - 진행 중인 작업이 있는지 확인
   - 다른 리소스와의 연결 상태 확인
4. **권한 확인**: 삭제 권한 보유 여부

### 2. 삭제 순서
1. **Online Store 비활성화**: 실시간 데이터 액세스 중단
2. **데이터 삭제** (--delete-data가 True인 경우):
   - Online store 데이터 삭제
   - Offline store 데이터 삭제 (S3, Athena 테이블)
3. **Feature Group 삭제**: 메타데이터 및 구성 정보 삭제
4. **정리 작업**: 
   - IAM 정책 정리 (필요시)
   - CloudWatch 메트릭 정리

### 3. 안전 장치
- **확인 프롬프트**: 삭제 전 사용자 확인 (--force 없는 경우)
- **Dry-run 모드**: 실제 삭제 없이 계획만 표시
- **백업 확인**: 중요한 데이터의 백업 여부 확인
- **복구 불가 경고**: 삭제 후 복구 불가능함을 명확히 안내

## 구현 세부사항

### 1. 파일 구조
- `src/sagemaker_fs_cli/commands/delete_cmd.py`: 메인 구현 파일
- CLI 명령어를 `cli.py`에 등록

### 2. 주요 기능

#### `delete_feature_group()`
- 메인 CLI 명령어 함수
- 옵션 파싱 및 검증
- 삭제 프로세스 실행

#### `_validate_deletion(feature_group_name)`
- Feature group 존재 확인
- 삭제 가능 상태 확인
- 종속성 검사
- 권한 확인

#### `_check_dependencies(feature_group_name)`
- 연결된 다른 리소스 확인
- 활성 상태의 작업 확인
- 경고 사항 수집

#### `_confirm_deletion(feature_group_name, dependencies)`
- 사용자 확인 프롬프트
- 삭제 계획 표시
- 위험 요소 안내

#### `_delete_data(feature_group_name, fg_details)`
- Online store 데이터 삭제
- Offline store 데이터 삭제
- S3 객체 및 Athena 테이블 정리

#### `_delete_feature_group_resource(feature_group_name)`
- Feature group 리소스 삭제
- 메타데이터 정리

#### `_cleanup_resources(feature_group_name)`
- 관련 리소스 정리
- IAM 정책 정리 (필요시)
- CloudWatch 정리

#### `_monitor_deletion(feature_group_name)`
- 삭제 진행 상황 모니터링
- 상태 업데이트 표시
- 완료/실패 확인

### 3. 확인 프롬프트 설계
```
⚠️  위험: Feature Group 완전 삭제

삭제할 Feature Group: my-feature-group
  - Online Store: 활성화됨 (데이터 있음)
  - Offline Store: 활성화됨 (S3: s3://bucket/path/, 약 1.2GB)
  - 생성일: 2024-01-15
  - 마지막 수정: 2024-01-20

⚠️  주의사항:
  - 이 작업은 되돌릴 수 없습니다
  - 모든 데이터가 영구적으로 삭제됩니다
  - 연결된 모델이나 파이프라인에 영향을 줄 수 있습니다

정말로 삭제하시겠습니까? (yes/no): 
```

### 4. Dry-run 출력
```
🔍 삭제 계획 (Dry Run)

Feature Group: my-feature-group
  상태: Created
  Online Store: 활성화됨
  Offline Store: 활성화됨

삭제 순서:
  1. ✓ Online Store 비활성화
  2. ✓ Online 데이터 삭제 (약 10,000건)
  3. ✓ Offline 데이터 삭제 (S3: ~1.2GB)
  4. ✓ Athena 테이블 삭제
  5. ✓ Feature Group 리소스 삭제
  6. ✓ 관련 메타데이터 정리

예상 소요 시간: 5-10분
복구 가능성: 불가능

--force 플래그 없이 실제 삭제하려면 확인이 필요합니다.
```

### 5. 삭제 진행 상황 표시
```
🗑️  Feature Group 삭제 시작: my-feature-group

✓ 삭제 가능성 검증 완료
✓ 종속성 확인 완료
✓ 사용자 확인 완료

⠋ Online Store 비활성화 중...
✓ Online Store 비활성화 완료

⠋ Online 데이터 삭제 중... (5,432/10,000)
✓ Online 데이터 삭제 완료 (10,000건)

⠋ Offline 데이터 삭제 중...
✓ S3 객체 삭제 완료 (1.2GB)
✓ Athena 테이블 삭제 완료

⠋ Feature Group 삭제 중...
✓ Feature Group 삭제 완료

✅ 모든 삭제 작업 완료!

삭제 요약:
  - Feature Group: my-feature-group
  - Online 레코드: 10,000건 삭제
  - Offline 데이터: 1.2GB 삭제
  - 소요 시간: 7분 23초
```

### 6. 에러 처리
1. **권한 오류**: IAM 권한 부족
2. **상태 오류**: 삭제 불가능한 상태
3. **종속성 오류**: 다른 리소스와 연결됨
4. **네트워크 오류**: AWS 서비스 연결 문제
5. **부분 실패**: 일부 리소스 삭제 실패 시 복구 방안 안내

### 7. 복구 가이드
삭제 실패시 사용자에게 복구 방안 제공:
```
❌ Feature Group 삭제 중 오류 발생

완료된 작업:
  ✓ Online Store 비활성화
  ✓ Online 데이터 삭제
  ❌ Offline 데이터 삭제 실패

복구 방안:
  1. 수동 정리 필요:
     - S3 경로 확인: s3://bucket/path/
     - Athena 테이블 확인: database.table_name
  
  2. 다시 시도:
     fs delete my-feature-group --force
  
  3. 지원 요청:
     AWS Support에 문의 (케이스 ID: xxx)
```

## 테스트 시나리오
1. **정상 삭제**: 모든 단계가 성공하는 경우
2. **권한 오류**: IAM 권한이 부족한 경우
3. **부분 실패**: 중간 단계에서 실패하는 경우
4. **종속성 존재**: 다른 리소스와 연결된 경우
5. **Dry-run 테스트**: 실제 삭제 없이 계획 표시
6. **강제 삭제**: --force 옵션 테스트
7. **데이터 유지**: --keep-data 옵션 테스트
8. **취소 테스트**: 확인 프롬프트에서 'no' 선택
9. **네트워크 오류**: AWS 연결 문제
10. **존재하지 않는 Feature Group**: 잘못된 이름 입력

## 안전성 고려사항
1. **이중 확인**: 중요한 삭제는 두 번 확인
2. **백업 권장**: 삭제 전 백업 생성 안내
3. **로그 기록**: 모든 삭제 작업 로그 기록
4. **알림 시스템**: 중요한 리소스 삭제시 알림
5. **복구 문서**: 삭제 후 복구 불가능함을 명확히 문서화

## 의존성
- boto3: SageMaker, S3, Athena 클라이언트
- click: CLI 프레임워크
- tqdm: 진행률 표시
- datetime: 시간 처리
- logging: 작업 로그 기록