# Feature Store 생성 기능 구현 계획

## 개요
SageMaker Feature Store CLI에 feature group 생성 기능을 추가합니다. 사용자는 간단한 명령어로 feature group을 생성하고 online/offline store를 구성할 수 있습니다.

## 명령어 설계

### 기본 명령어 구조
```bash
fs create [OPTIONS] FEATURE_GROUP_NAME
```

### 주요 옵션
- `--description TEXT`: Feature group 설명
- `--record-identifier-name TEXT`: 레코드 식별자 필드명 (기본값: 'id')
- `--event-time-feature-name TEXT`: 이벤트 시간 필드명 (기본값: 'event_time')
- `--schema-file PATH`: 스키마 정의 JSON 파일 경로 (필수)
- `--online-store / --no-online-store`: Online store 활성화 여부 (기본값: True)
- `--offline-store / --no-offline-store`: Offline store 활성화 여부 (기본값: True)
- `--s3-uri TEXT`: Offline store S3 URI (offline store 사용시 필수)
- `--role-arn TEXT`: IAM 역할 ARN (필수)
- `--enable-encryption / --no-encryption`: 암호화 활성화 여부 (기본값: False)
- `--kms-key-id TEXT`: KMS 키 ID (암호화 사용시)
- `--table-format TEXT`: 테이블 형식 (기본값: 'Iceberg', 선택값: 'Iceberg', 'Glue')
- `--throughput-mode TEXT`: 처리량 모드 (기본값: 'OnDemand', 선택값: 'OnDemand', 'Provisioned')
- `--read-capacity-units INTEGER`: 읽기 용량 단위 (Provisioned 모드에서만)
- `--write-capacity-units INTEGER`: 쓰기 용량 단위 (Provisioned 모드에서만)
- `--tags TEXT`: 태그 (key=value 형식, 다중 지정 가능)
- `--wait / --no-wait`: 생성 완료까지 대기 여부 (기본값: True)

### 사용 예시
```bash
# 기본 생성 (online + offline)
fs create my-feature-group \
  --schema-file schema.json \
  --role-arn arn:aws:iam::123456789012:role/SageMakerRole \
  --s3-uri s3://my-bucket/feature-store/

# Online store만 생성
fs create my-online-feature-group \
  --schema-file schema.json \
  --role-arn arn:aws:iam::123456789012:role/SageMakerRole \
  --no-offline-store

# 고급 설정으로 생성
fs create my-advanced-feature-group \
  --schema-file schema.json \
  --role-arn arn:aws:iam::123456789012:role/SageMakerRole \
  --s3-uri s3://my-bucket/feature-store/ \
  --description "고객 프로필 피처 그룹" \
  --record-identifier-name customer_id \
  --event-time-feature-name timestamp \
  --enable-encryption \
  --kms-key-id alias/sagemaker-key \
  --table-format Iceberg \
  --throughput-mode Provisioned \
  --read-capacity-units 5 \
  --write-capacity-units 5 \
  --tags environment=production --tags team=ml
```

## 스키마 파일 형식

### JSON 형식
```json
[
  {
    "FeatureName": "customer_id",
    "FeatureType": "String"
  },
  {
    "FeatureName": "age",
    "FeatureType": "Integral"
  },
  {
    "FeatureName": "balance",
    "FeatureType": "Fractional"
  },
  {
    "FeatureName": "event_time",
    "FeatureType": "String"
  }
]
```

### 지원되는 데이터 타입
- `String`: 문자열 타입
- `Integral`: 정수 타입
- `Fractional`: 소수 타입

## 구현 세부사항

### 1. 파일 구조
- `src/sagemaker_fs_cli/commands/create_cmd.py`: 메인 구현 파일
- CLI 명령어를 `cli.py`에 등록

### 2. 주요 기능
1. **스키마 검증**: JSON 파일 형식과 필수 필드 검증
2. **설정 검증**: 
   - Online/Offline store 최소 하나는 활성화
   - Offline store 사용시 S3 URI 필수
   - Provisioned 모드시 capacity units 필수
   - 암호화 사용시 KMS 키 검증
3. **IAM 역할 검증**: 역할 존재 및 권한 확인
4. **Feature Group 생성**: AWS SDK를 통한 생성
5. **진행 상황 표시**: 생성 진행 상황 모니터링
6. **에러 처리**: 상세한 에러 메시지 제공

### 3. 핵심 함수 설계

#### `create_feature_group()`
- 메인 CLI 명령어 함수
- 인자 검증 및 기본값 설정
- 스키마 파일 로드 및 검증
- Feature group 생성 호출

#### `_validate_schema(schema_data)`
- 스키마 형식 검증
- 필수 필드 확인 (FeatureName, FeatureType)
- 데이터 타입 검증

#### `_validate_configuration()`
- 설정값 일관성 검증
- Store 설정 검증
- IAM 역할 검증

#### `_create_feature_group_config()`
- SageMaker 생성 요청 구성
- Online/Offline store 설정
- 보안 및 처리량 설정

#### `_wait_for_creation(feature_group_name)`
- 생성 상태 모니터링
- 진행률 표시
- 완료/실패 상태 확인

### 4. 에러 처리
- 스키마 파일 오류: 파일 존재, JSON 형식, 스키마 구조
- IAM 권한 오류: 역할 존재, SageMaker 권한
- AWS 서비스 오류: 네트워크, 할당량, 중복 이름
- 설정 오류: 필수 매개변수, 호환되지 않는 옵션

### 5. 출력 형식
```
✓ 스키마 검증 완료 (4개 필드)
✓ IAM 역할 검증 완료
✓ Feature Group 생성 시작: my-feature-group
⠋ Feature Group 생성 중... (Creating)
✓ Feature Group 생성 완료!

Feature Group 정보:
  이름: my-feature-group
  상태: Created
  Online Store: 활성화됨
  Offline Store: 활성화됨 (s3://my-bucket/feature-store/)
  생성 시간: 2024-XX-XX XX:XX:XX KST
```

## 테스트 시나리오
1. 기본 생성 테스트 (online + offline)
2. Online store만 생성
3. Offline store만 생성
4. 암호화 옵션 테스트
5. Provisioned 처리량 모드 테스트
6. 스키마 검증 오류 테스트
7. IAM 권한 오류 테스트
8. 중복 이름 오류 테스트
9. 태그 설정 테스트
10. 대기 옵션 테스트 (--no-wait)

## 의존성
- boto3: SageMaker 클라이언트
- click: CLI 프레임워크
- tqdm: 진행률 표시
- json: 스키마 파일 처리
- datetime: 시간 처리