# bulk-update ëª…ë ¹ì–´

SageMaker Feature Storeì˜ ì˜¤í”„ë¼ì¸ ìŠ¤í† ì–´(S3 Parquet íŒŒì¼)ì—ì„œ íŠ¹ì • ì»¬ëŸ¼ ê°’ì„ íš¨ìœ¨ì ìœ¼ë¡œ ëŒ€ëŸ‰ ì—…ë°ì´íŠ¸í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. Athena ì¿¼ë¦¬ë¥¼ í†µí•œ ìµœì í™”ëœ ì²˜ë¦¬ì™€ ë‹¤ì–‘í•œ ë³€í™˜ í•¨ìˆ˜ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

## ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
fs bulk-update <feature_group_name> --column <column_name> [ì—…ë°ì´íŠ¸ ë°©ì‹] [ì˜µì…˜]
```

## ë§¤ê°œë³€ìˆ˜

### í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜
- `feature_group_name`: ì—…ë°ì´íŠ¸í•  í”¼ì²˜ ê·¸ë£¹ ì´ë¦„
- `--column`: ì—…ë°ì´íŠ¸í•  ì»¬ëŸ¼ëª…

### ì—…ë°ì´íŠ¸ ë°©ì‹ (í•„ìˆ˜ - í•˜ë‚˜ë§Œ ì„ íƒ)

#### 1. ë‹¨ì¼ ê°’ ë³€ê²½
- `--old-value`: ë³€ê²½í•  ê¸°ì¡´ ê°’
- `--new-value`: ìƒˆë¡œìš´ ê°’

#### 2. ë§¤í•‘ íŒŒì¼ ì‚¬ìš©
- `--mapping-file`: ë§¤í•‘ íŒŒì¼ ê²½ë¡œ (.json ë˜ëŠ” .csv)

#### 3. ì¡°ê±´ë¶€ ë§¤í•‘
- `--conditional-mapping`: ì¡°ê±´ë¶€ ë§¤í•‘ JSON ë¬¸ìì—´

#### 4. ë³€í™˜ í•¨ìˆ˜
- `--transform-function`: ë³€í™˜ í•¨ìˆ˜ íƒ€ì…
  - `regex_replace`: ì •ê·œì‹ íŒ¨í„´ ì¹˜í™˜
  - `prefix_suffix`: ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ ì¶”ê°€
  - `uppercase`: ëŒ€ë¬¸ì ë³€í™˜
  - `lowercase`: ì†Œë¬¸ì ë³€í™˜
  - `copy_from_column`: ë‹¤ë¥¸ ì»¬ëŸ¼ì—ì„œ ê°’ ë³µì‚¬
  - `extract_time_prefix`: íŒŒì¼ëª…/ì»¬ëŸ¼ì—ì„œ ì‹œê°„ ì •ë³´ ì¶”ì¶œ

### ë³€í™˜ í•¨ìˆ˜ë³„ ì¶”ê°€ ì˜µì…˜

#### regex_replace
- `--regex-pattern`: ì •ê·œì‹ íŒ¨í„´ (í•„ìˆ˜)
- `--regex-replacement`: ì •ê·œì‹ ì¹˜í™˜ ë¬¸ìì—´ (ê¸°ë³¸ê°’: ë¹ˆ ë¬¸ìì—´)

#### prefix_suffix
- `--prefix`: ì ‘ë‘ì‚¬ (ê¸°ë³¸ê°’: ë¹ˆ ë¬¸ìì—´)
- `--suffix`: ì ‘ë¯¸ì‚¬ (ê¸°ë³¸ê°’: ë¹ˆ ë¬¸ìì—´)

#### copy_from_column
- `--source-column`: ë³µì‚¬í•  ì›ë³¸ ì»¬ëŸ¼ëª… (í•„ìˆ˜)

#### extract_time_prefix
- `--source-column`: ì‹œê°„ì„ ì¶”ì¶œí•  ì›ë³¸ ì»¬ëŸ¼ëª…
- `--prefix-pattern`: ì‹œê°„ ì¶”ì¶œìš© ì •ê·œì‹ íŒ¨í„´ (ê¸°ë³¸ê°’: `(\d{4}-\d{2}-\d{2})`)
- `--time-format`: ì‹œê°„ í˜•ì‹ (ê¸°ë³¸ê°’: auto)
- `--to-iso/--no-to-iso`: ì¶”ì¶œëœ ì‹œê°„ì„ ISO í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ê¸°ë³¸ê°’: True)

### ì‹¤í–‰ ì œì–´ ì˜µì…˜
- `--dry-run`: ì‹¤ì œ ì‹¤í–‰í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ë§Œ ìˆ˜í–‰ (ê¸°ë³¸ê°’: True)
- `--no-dry-run`: ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸
- `--skip-validation`: Athena ê²€ì¦ ê±´ë„ˆë›°ê¸°

### ì„±ëŠ¥ ìµœì í™” ì˜µì…˜
- `--filter-null-only`: ì§€ì •ëœ ì»¬ëŸ¼ì˜ null ê°’ë§Œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
- `--filter-column`: ì¶”ê°€ í•„í„° ì»¬ëŸ¼ëª…
- `--filter-value`: ì¶”ê°€ í•„í„° ê°’
- `--batch-size`: ë°°ì¹˜ í¬ê¸° (ê¸°ë³¸ê°’: 1000, ìµœëŒ€: 10000)
- `--deduplicate/--no-deduplicate`: ì¤‘ë³µ record_id ì œê±° (ê¸°ë³¸ê°’: True)

### ê´€ë¦¬ ì˜µì…˜
- `--cleanup-backups`: ë°±ì—… íŒŒì¼ ìë™ ì •ë¦¬

## ì‚¬ìš© ì˜ˆì‹œ

### 1. ë‹¨ì¼ ê°’ ë³€ê²½

```bash
# ê¸°ë³¸ ì‚¬ìš©ë²• (dry-run)
fs bulk-update my-feature-group --column status --old-value "old" --new-value "new"

# ì‹¤ì œ ì—…ë°ì´íŠ¸ ì‹¤í–‰
fs bulk-update my-feature-group --column status --old-value "old" --new-value "new" --no-dry-run
```

### 2. ë§¤í•‘ íŒŒì¼ ì‚¬ìš©

#### JSON ë§¤í•‘ íŒŒì¼ (mapping.json)
```json
{
  "ABNORMAL": "NORMAL",
  "ERROR": "FIXED",
  "PENDING": "COMPLETED",
  "null": "DEFAULT"
}
```

```bash
# ë§¤í•‘ íŒŒì¼ë¡œ ì—…ë°ì´íŠ¸
fs bulk-update my-feature-group --column status --mapping-file mapping.json --no-dry-run
```

#### CSV ë§¤í•‘ íŒŒì¼ (mapping.csv)
```csv
old_value,new_value
ABNORMAL,NORMAL
ERROR,FIXED
PENDING,COMPLETED
```

```bash
fs bulk-update my-feature-group --column status --mapping-file mapping.csv --no-dry-run
```

### 3. ì¡°ê±´ë¶€ ë§¤í•‘

```bash
# ë³µì¡í•œ ì¡°ê±´ë¶€ ë§¤í•‘
fs bulk-update my-feature-group --column result \
  --conditional-mapping '{"category": {"A": {"old": "new"}}}' --no-dry-run
```

### 4. ë³€í™˜ í•¨ìˆ˜ ì‚¬ìš©

#### ëŒ€ì†Œë¬¸ì ë³€í™˜
```bash
# ëŒ€ë¬¸ìë¡œ ë³€í™˜
fs bulk-update my-feature-group --column data --transform-function uppercase --no-dry-run

# ì†Œë¬¸ìë¡œ ë³€í™˜
fs bulk-update my-feature-group --column data --transform-function lowercase --no-dry-run
```

#### ì •ê·œì‹ íŒ¨í„´ ì¹˜í™˜
```bash
# ì •ê·œì‹ìœ¼ë¡œ íŒ¨í„´ ì¹˜í™˜
fs bulk-update my-feature-group --column text \
  --transform-function regex_replace \
  --regex-pattern "error_(\d+)" \
  --regex-replacement "fixed_\1" --no-dry-run

# íŒ¨í„´ ì œê±° (ë¹ˆ ë¬¸ìì—´ë¡œ ì¹˜í™˜)
fs bulk-update my-feature-group --column filename \
  --transform-function regex_replace \
  --regex-pattern "old_.*" \
  --regex-replacement "" --no-dry-run
```

#### ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ ì¶”ê°€
```bash
# ì ‘ë‘ì‚¬ ì¶”ê°€
fs bulk-update my-feature-group --column identifier \
  --transform-function prefix_suffix \
  --prefix "NEW_" --no-dry-run

# ì ‘ë¯¸ì‚¬ ì¶”ê°€
fs bulk-update my-feature-group --column filename \
  --transform-function prefix_suffix \
  --suffix "_processed" --no-dry-run

# ì ‘ë‘ì‚¬ì™€ ì ‘ë¯¸ì‚¬ ëª¨ë‘ ì¶”ê°€
fs bulk-update my-feature-group --column name \
  --transform-function prefix_suffix \
  --prefix "prod_" --suffix "_v2" --no-dry-run
```

#### ë‹¤ë¥¸ ì»¬ëŸ¼ì—ì„œ ê°’ ë³µì‚¬
```bash
# ë‹¤ë¥¸ ì»¬ëŸ¼ì˜ ê°’ì„ ë³µì‚¬ (null ê°’ë§Œ ëŒ€ìƒ)
fs bulk-update my-feature-group --column target_col \
  --transform-function copy_from_column \
  --source-column source_col \
  --filter-null-only --no-dry-run
```

#### ì‹œê°„ ì •ë³´ ì¶”ì¶œ ë° ë³€í™˜
```bash
# íŒŒì¼ëª…ì—ì„œ ì‹œê°„ ì¶”ì¶œ í›„ ISO í˜•ì‹ìœ¼ë¡œ ë³€í™˜
fs bulk-update mlops-feature-group --column Origin_Time \
  --transform-function extract_time_prefix \
  --prefix-pattern '(\d{14})' \
  --source-column Filename \
  --filter-null-only --no-dry-run

# 8ìë¦¬ ë‚ ì§œ í˜•ì‹ ì¶”ì¶œ
fs bulk-update my-feature-group --column date_field \
  --transform-function extract_time_prefix \
  --prefix-pattern '(\d{8})' \
  --source-column data_path \
  --time-format '%Y%m%d' \
  --filter-null-only --no-dry-run
```

### 5. ì„±ëŠ¥ ìµœì í™” ì˜ˆì‹œ

```bash
# null ê°’ë§Œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
fs bulk-update my-feature-group --column status \
  --old-value "null" --new-value "default" \
  --filter-null-only --no-dry-run

# íŠ¹ì • ì¡°ê±´ì˜ ë ˆì½”ë“œë§Œ ëŒ€ìƒ
fs bulk-update my-feature-group --column status \
  --old-value "processing" --new-value "completed" \
  --filter-column environment --filter-value "production" \
  --batch-size 2000 --no-dry-run

# ë°±ì—… íŒŒì¼ ì •ë¦¬ì™€ í•¨ê»˜
fs bulk-update my-feature-group --column RB_Result \
  --mapping-file status_mapping.json \
  --filter-null-only \
  --cleanup-backups \
  --no-dry-run
```

## ì‹¤ë¬´ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### 1. íŒŒì¼ëª…ì—ì„œ ì‹œê°„ ì¶”ì¶œ
MLOps í™˜ê²½ì—ì„œ íŒŒì¼ëª…ì— í¬í•¨ëœ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ Origin_Time ì»¬ëŸ¼ì— ì €ì¥:

```bash
fs bulk-update {s3_bucket}\
  --column Origin_Time \
  --transform-function extract_time_prefix \
  --prefix-pattern '(\d{14})' \
  --source-column Filename \
  --filter-null-only \
  --no-dry-run
```

**ì ìš© ì˜ˆì‹œ:**
- Filename: `"data_20240115103045_v1.parquet"`
- Origin_Time: `"2024-01-15T10:30:45Z"`

### 2. ìƒíƒœ ê°’ ì¼ê´„ ë³€ê²½
ë¹„ì •ìƒ ìƒíƒœê°’ë“¤ì„ ì •ìƒ ìƒíƒœë¡œ ì¼ê´„ ë³€ê²½:

```bash
# status_mapping.json
{
  "ABNORMAL": "NORMAL",
  "ERROR": "FIXED",
  "PENDING": "COMPLETED",
  "UNKNOWN": "DEFAULT"
}

fs bulk-update production-feature-group \
  --column RB_Result \
  --mapping-file status_mapping.json \
  --filter-null-only \
  --cleanup-backups \
  --no-dry-run
```

### 3. í™˜ê²½ë³„ ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸
í”„ë¡œë•ì…˜ í™˜ê²½ì˜ íŠ¹ì • ìƒíƒœë§Œ ì—…ë°ì´íŠ¸:

```bash
fs bulk-update prod-feature-group \
  --column status --old-value "processing" --new-value "completed" \
  --filter-column environment --filter-value "production" \
  --batch-size 2000 \
  --no-dry-run
```

### 4. ë°ì´í„° í’ˆì§ˆ ê°œì„ 
null ê°’ë“¤ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •:

```bash
fs bulk-update my-feature-group --column score \
  --old-value "null" --new-value "0.0" \
  --filter-null-only \
  --no-dry-run
```

## DRY-RUN ëª¨ë“œ

ê¸°ë³¸ì ìœ¼ë¡œ `--dry-run` ëª¨ë“œë¡œ ì‹¤í–‰ë˜ì–´ ì‹¤ì œ ë³€ê²½ ì—†ì´ ë‹¤ìŒ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

### ì¶œë ¥ ì •ë³´
- ë³€ê²½ ëŒ€ìƒ ë ˆì½”ë“œ ìˆ˜
- ì˜ˆìƒ ì†Œìš” ì‹œê°„
- ì„¸ë¶€ ë¶„ì„ ë¦¬í¬íŠ¸
- ë³€ê²½ë  ê°’ë“¤ì˜ ë¯¸ë¦¬ë³´ê¸°
- ì²˜ë¦¬í•  íŒŒì¼ ëª©ë¡

### ì˜ˆìƒ ì‹œê°„ ë³´ê³ ì„œ
```
ğŸ“Š ì˜ˆìƒ ì†Œìš” ì‹œê°„ ë³´ê³ ì„œ
====================
â€¢ ì´ ì²˜ë¦¬ ëŒ€ìƒ íŒŒì¼: 150ê°œ
â€¢ ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„: 25ë¶„ 30ì´ˆ
â€¢ ë³€ê²½ ëŒ€ìƒ ë ˆì½”ë“œ: 45,231ê°œ
â€¢ ì˜ˆìƒ ë°±ì—… ìš©ëŸ‰: 1.2GB
```

## ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬

### ìë™ ë°±ì—… ì‹œìŠ¤í…œ
- ë³€ê²½ ì „ ìë™ìœ¼ë¡œ ë¡œì»¬ ë°±ì—… ìƒì„±
- ë°±ì—… ìœ„ì¹˜: `./backups/` í´ë”
- ë°±ì—… íŒŒì¼ëª…: `backup_[feature-group]_[column]_[timestamp].parquet`

### ì‹¤íŒ¨ ë¦¬í¬íŠ¸
ì²˜ë¦¬ ì‹¤íŒ¨í•œ íŒŒì¼ë“¤ì— ëŒ€í•œ ìƒì„¸ ë¦¬í¬íŠ¸ê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤:
- `failed_files_[feature-group]_[column]_[timestamp].json`
- `failed_files_[feature-group]_[column]_[timestamp].txt`

### ì¤‘ë³µ ë°ì´í„° ì²˜ë¦¬
- `--deduplicate` (ê¸°ë³¸ê°’): EventTime ê¸°ì¤€ìœ¼ë¡œ ìµœì‹  ë°ì´í„°ë§Œ ìœ ì§€
- ì¤‘ë³µ ì œê±° í›„ ì—…ë°ì´íŠ¸ ìˆ˜í–‰

## ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

### 1. íŒŒì¼ ì„ ë³„ ìµœì í™”
```bash
# Athenaë¥¼ í†µí•œ ëŒ€ìƒ íŒŒì¼ë§Œ ì„ ë³„
--filter-null-only  # null ê°’ì´ ìˆëŠ” íŒŒì¼ë§Œ ì²˜ë¦¬
```

### 2. ë°°ì¹˜ í¬ê¸° ì¡°ì •
```bash
--batch-size 500   # ì‘ì€ ë°°ì¹˜ (ì•ˆì •ì„± ìš°ì„ )
--batch-size 2000  # í° ë°°ì¹˜ (ì„±ëŠ¥ ìš°ì„ )
```

### 3. í•„í„° ì¡°ê±´ í™œìš©
```bash
# íŠ¹ì • ì¡°ê±´ì˜ ë ˆì½”ë“œë§Œ ì²˜ë¦¬
--filter-column region --filter-value "us-east-1"
```

### 4. ë³‘ë ¬ ì²˜ë¦¬
- ìµœëŒ€ 5ê°œ ì›Œì»¤ë¡œ ë³‘ë ¬ ì²˜ë¦¬
- ëŒ€ìš©ëŸ‰ ë°ì´í„°ëŠ” ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ê¶Œì¥ (`nohup`, `screen`)

## ì•ˆì „ì„± ê¸°ëŠ¥

### 1. ê¸°ë³¸ ì•ˆì „ ì„¤ì •
- ê¸°ë³¸ì ìœ¼ë¡œ `--dry-run` ëª¨ë“œ
- ì‹¤ì œ ë³€ê²½ì€ `--no-dry-run` í”Œë˜ê·¸ í•„ìš”
- ìë™ ë°±ì—… ìƒì„±

### 2. ë°ì´í„° ë¬´ê²°ì„±
- EventTime ìë™ ì—…ë°ì´íŠ¸
- Feature Store ë™ê¸°í™” ë³´ì¥
- ì¤‘ë³µ record_id ìë™ ì œê±°

### 3. ë¡¤ë°± ì§€ì›
ë°±ì—… íŒŒì¼ì„ ì´ìš©í•œ ìˆ˜ë™ ë¡¤ë°± ê°€ëŠ¥

## ê¶Œí•œ ìš”êµ¬ì‚¬í•­

### AWS ê¶Œí•œ
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::sagemaker-*",
        "arn:aws:s3:::sagemaker-*/*"
      ]
    },
    {
      "Effect": "Allow", 
      "Action": [
        "athena:StartQueryExecution",
        "athena:GetQueryExecution",
        "athena:GetQueryResults"
      ],
      "Resource": "*"
    }
  ]
}
```

### ë¡œì»¬ ì‹œìŠ¤í…œ
- ì¶©ë¶„í•œ ë””ìŠ¤í¬ ê³µê°„ (ë°±ì—… íŒŒì¼ ì €ì¥ìš©)
- íŒŒì¼ ì½ê¸°/ì“°ê¸° ê¶Œí•œ

## ì£¼ì˜ì‚¬í•­

### âš ï¸ ì¤‘ìš” ê²½ê³ 
1. **ë°ì´í„° ë°±ì—…**: ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ë³„ë„ ë°±ì—… í›„ ì§„í–‰
2. **í…ŒìŠ¤íŠ¸ í™˜ê²½**: í”„ë¡œë•ì…˜ ì ìš© ì „ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ê²€ì¦
3. **ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰**: ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ì¶©ë¶„í•œ ë©”ëª¨ë¦¬ í™•ë³´
4. **ë¹„ìš© ê³ ë ¤**: S3 ì½ê¸°/ì“°ê¸° ë¹„ìš© ë°œìƒ

### ğŸ’¡ ëª¨ë²” ì‚¬ë¡€
1. **ë‹¨ê³„ì  ì ‘ê·¼**: ì‘ì€ ë°ì´í„°ì…‹ë¶€í„° í…ŒìŠ¤íŠ¸
2. **ëª¨ë‹ˆí„°ë§**: ì²˜ë¦¬ ë¡œê·¸ ë° ì‹¤íŒ¨ ë¦¬í¬íŠ¸ í™•ì¸
3. **ê²€ì¦**: ì—…ë°ì´íŠ¸ í›„ ë°ì´í„° í’ˆì§ˆ ê²€ì¦
4. **ë¬¸ì„œí™”**: ë³€ê²½ ì‚¬í•­ ê¸°ë¡ ìœ ì§€

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 1. ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# ë°°ì¹˜ í¬ê¸° ì¤„ì´ê¸°
--batch-size 200
```

#### 2. ê¶Œí•œ ì˜¤ë¥˜
- AWS í”„ë¡œí•„ í™•ì¸: `aws configure list`
- S3 ë²„í‚· ì ‘ê·¼ ê¶Œí•œ í™•ì¸

#### 3. Athena ì¿¼ë¦¬ ì‹¤íŒ¨
```bash
# Athena ê²€ì¦ ê±´ë„ˆë›°ê¸°
--skip-validation
```

#### 4. ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ
- ì•ˆì •ì ì¸ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ ì‹¤í–‰
- ë°°ì¹˜ í¬ê¸° ì¡°ì •

### ë¡œê·¸ íŒŒì¼ ìœ„ì¹˜
- ì‹¤í–‰ ë¡œê·¸: ì½˜ì†” ì¶œë ¥
- ì‹¤íŒ¨ ë¦¬í¬íŠ¸: `./failed_files_*.json/txt`
- ë°±ì—… íŒŒì¼: `./backups/`

## ê´€ë ¨ ëª…ë ¹ì–´

- `fs analyze`: í”¼ì²˜ ìŠ¤í† ì–´ ë¶„ì„
- `fs clear`: ë°ì´í„° ì‚­ì œ ë° ì¤‘ë³µ ì œê±°
- `fs migrate`: í”¼ì²˜ ê·¸ë£¹ ê°„ ë°ì´í„° ì´ë™
- `fs read-parquet`: Parquet íŒŒì¼ ë¶„ì„